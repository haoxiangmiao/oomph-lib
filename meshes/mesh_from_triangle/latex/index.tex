In this document we demonstrate how to generate unstructured triangular meshes for {\ttfamily oomph-\/lib}, based on the output from \href{http://www.cs.berkeley.edu/~jrs/}{\tt Jonathan Shewchuk\textquotesingle{}s} open-\/source mesh generator \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle}.} The mesh generation is performed in a two-\/stage process. First we use \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } to generate the mesh \char`\"{}offline\char`\"{}. Then we process the output files generated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } to generate an {\ttfamily oomph-\/lib} mesh.

You should also consult \href{../../../../doc/meshes/mesh_from_inline_triangle/html/index.html}{\tt another tutorial} where we discuss how to generate (and adapt) unstructured meshes from within {\ttfamily oomph-\/lib} driver codes.



 

\hypertarget{index_triangle_use}{}\section{Quick Guide for the use of Triangle}\label{index_triangle_use}
The \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} home page} contains a comprehensive User\textquotesingle{}s Guide for the code and its many options, therefore we only present a brief overview of the code\textquotesingle{}s most basic usage.

\href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } creates the mesh based on the information about the mesh boundaries provided in an input file, {\ttfamily filename.\+poly}, say. By default, three output files, {\ttfamily filename.\+1.\+poly}, {\ttfamily filename.\+1.\+node}, and {\ttfamily filename.\+1.\+ele} are created. They contain the information about the polygonal mesh boundaries, the nodal positions and the element connectivity lists, respectively.



\hypertarget{index_input}{}\subsection{The input file format}\label{index_input}
The input file for \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } (usually a file with the extension {\ttfamily $\ast$}. {\ttfamily poly}) has the following format\+:

\tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*{1}{|X[-1]}|}
\hline
{\bfseries Nodes\+:} 

First line\+: \mbox{[}number of vertices\mbox{]} \mbox{[}dimension (must be 2)\mbox{]} \mbox{[}number of attributes for nodes\mbox{]} \mbox{[}number of boundary markers for nodes (0 or 1)\mbox{]} ~\newline
Following lines\+: \mbox{[}vertex index\mbox{]} \mbox{[}x\mbox{]} \mbox{[}y\mbox{]} \mbox{[}\mbox{[}attributes\mbox{]}\mbox{]} \mbox{[}\mbox{[}boundary marker\mbox{]}\mbox{]} ~\newline
 {\bfseries Segments\+:} 

One line\+: \mbox{[}number of segments\mbox{]} \mbox{[}number of boundary markers for segments (0 or 1)\mbox{]} ~\newline
Following lines\+: \mbox{[}segment index\mbox{]} \mbox{[}endpoint\mbox{]} \mbox{[}endpoint\mbox{]} \mbox{[}\mbox{[}boundary marker\mbox{]}\mbox{]} ~\newline
 {\bfseries Holes\+:} 

One line\+: \mbox{[}number of holes\mbox{]} ~\newline
Following lines\+: \mbox{[}hole index\mbox{]} \mbox{[}x\mbox{]} \mbox{[}y\mbox{]} ~\newline
   \\\cline{1-1}
\end{longtabu}


{\bfseries Comments\+:} 
\begin{DoxyItemize}
\item The data between \mbox{[} \mbox{]} must be provided.
\item The attributes and boundary markers (i.\+e. data surrounded by \mbox{[}\mbox{[} \mbox{]}\mbox{]} ) must only be specified if the corresponding number of boundary markers and the number of attributes specified at the beginning of the relevant block is nonzero.
\item The \char`\"{}segments\char`\"{} define boundary edges, i.\+e. exterior boundaries and boundaries of holes. All boundary edges should be specified as segments, otherwise {\ttfamily Triangle} may triangulate regions that are not part of the domain.
\item Boundary markers should be used to identify which nodes are located on which domain boundaries. If domain boundaries are to be identified (this is strongly recommended as {\ttfamily oomph-\/lib} driver codes tend to require this information to apply boundary conditions), the number of boundary markers should be set to 1, otherwise it must be set to zero.
\item If the number of boundary markers is set to 1, boundary markers must be specified for every node or segment. To be consistent with {\ttfamily oomph-\/lib\textquotesingle{}s} (zero-\/based) boundary numbering schemes, a boundary marker 0 should be used for nodes that are not located on domain boundaries; a boundary marker {\ttfamily b+1} should be used to indicate that a node is located on the mesh boundary {\ttfamily b} in the final {\ttfamily oomph-\/lib} mesh.
\item {\ttfamily oomph-\/lib} does not currently use the \char`\"{}attributes\char`\"{} so their number should be set to zero. \mbox{[}{\bfseries Note\+:} The attributes are likely to be used to define boundary coordinates in future releases of {\ttfamily oomph-\/lib}.\mbox{]}
\item If a node is located on multiple boundaries, \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } assigns the boundary marker for the node arbitrarily.
\item It is important to specify the boundary markers via the segments rather than the nodes if the mesh contains multiple boundaries.
\item Each hole is identified by the coordinates of a single point in its interior.
\item Blank lines and comments prefixed by `\#\textquotesingle{} may be placed anywhere.
\item Input files for {\ttfamily Triangle} may contain optional additional lines which specify, e.\+g. area constraints. See the \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} home page} for further information.
\end{DoxyItemize}

\hypertarget{index_run_triangle}{}\subsection{How to run Triangle}\label{index_run_triangle}
To create the mesh from a given input file the command is


\begin{DoxyCode}
./triangle filename.poly
\end{DoxyCode}


If the domain contains a hole the argument {\ttfamily -\/pc} must be added, i.\+e.


\begin{DoxyCode}
./triangle -pc filename.poly 
\end{DoxyCode}


With these commands, {\ttfamily Triangle} will generate as few triangles as possible. Finer meshes may be generated by imposing additional constraints via command line arguments. For instance\+:
\begin{DoxyItemize}
\item A maximum triangle area can be specified with {\ttfamily -\/a}{\itshape n} where {\itshape n} is the maximum permitted area. (There is no space between {\ttfamily -\/a} and the number specifying the area!)
\item A minimum angle for the triangles can be specified with {\ttfamily -\/q} to avoid angles smaller than 20 degree or {\ttfamily -\/q}{\itshape n} where {\itshape n} is the minimum permitted angle.
\item ...
\end{DoxyItemize}Again, we refer to the \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} home page} for a comprehensive listing of all available options.

When run with an input file {\ttfamily filename.\+poly}, \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } generates output files called {\ttfamily filename.\+1.\+node}, {\ttfamily filename.\+1.\+ele} and {\ttfamily filename.\+1.\+node} which can be processed to generate an {\ttfamily oomph-\/lib} mesh.



\hypertarget{index_showme}{}\subsection{How to visualise a mesh generated by Triangle}\label{index_showme}
To visualise the mesh, the program {\ttfamily showme} (distributed with \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } ) can be used.



 

\hypertarget{index_example}{}\section{An example\+: A rectangle with a hole}\label{index_example}
To illustrate the procedure, we demonstrate how to generate a mesh for the rectangular domain with a hole shown in the figure below. The domain is defined by two boundary segments, each of which connect four points. Note that the node and boundary numbers correspond to those in the \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } input file. In the corresponding {\ttfamily oomph-\/lib} mesh, the boundaries are numbered from zero.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{box_hole}
\doxyfigcaption{A rectangular domain with a rectangular hole. }
\end{DoxyImage}


The input file, {\ttfamily box\+\_\+hole.\+poly}, for this domain is\+: 
\begin{DoxyCodeInclude}
# A box with eight points in 2D, no attributes,no boundary marker
8 2 0 0
# Outer box has these vertices
1 0 0 
2 0 3 
3 3 0 
4 3 3 
# Inner square has these vertices:
5 1 1 
6 1 2 
7 2 1 
8 2 2 
# Eight segments with boundary markers.
8 1 
1 1 2 1      # Outer box is boundary 1
2 2 4 1      
3 3 4 1      
4 3 1 1      
5 5 7 2      # Inner box is boundary 2
6 7 8 2 
7 8 6 2
8 6 5 2
# One hole in the middle of the inner square.
1
1 1.5 1.5 
\end{DoxyCodeInclude}


When run as {\ttfamily  ./triangle -\/pc -\/a0.\+1 -\/q35 box\+\_\+hole.\+poly } \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } creates the output files \href{../../../../demo_drivers/meshing/mesh_from_triangle/box_hole.1.node}{\tt box\+\_\+hole.\+1.\+node} and \href{../../../../demo_drivers/meshing/mesh_from_triangle/box_hole.1.ele}{\tt box\+\_\+hole.\+1.\+ele} and \href{../../../../demo_drivers/meshing/mesh_from_triangle/box_hole.1.poly}{\tt box\+\_\+hole.\+1.\+poly}. Here is a sketch of the resulting triangulation, as displayed by {\ttfamily showme} \+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{showme_screenshot}
\doxyfigcaption{Screenshot of showme, showing the triangulation of the rectangular domain with a hole. }
\end{DoxyImage}




 

\hypertarget{index_oomph_use}{}\section{Creating an oomph-\/lib mesh based on output files generated by Triangle}\label{index_oomph_use}
{\ttfamily oomph-\/lib} provides a mesh, {\ttfamily Triangle\+Mesh}, that uses the output from \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } to generate an {\ttfamily oomph-\/lib} Mesh containing elements from the {\ttfamily T\+Element$<$2,\+N\+N\+O\+D\+E\+\_\+1\+D$>$} family of the triangular elements. The relevant interface is\+:

 
\begin{DoxyCodeInclude}
\textcolor{comment}{//============start\_of\_triangle\_class===================================}
\textcolor{comment}{/// Triangle mesh build with the help of the scaffold mesh coming  }
\textcolor{comment}{}\textcolor{comment}{/// from the triangle mesh generator Triangle.}
\textcolor{comment}{}\textcolor{comment}{/// http://www.cs.cmu.edu/~quake/triangle.html}
\textcolor{comment}{}\textcolor{comment}{//======================================================================}
 \textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>
 \textcolor{keyword}{class }TriangleMesh : \textcolor{keyword}{public} \textcolor{keyword}{virtual} TriangleMeshBase
 \{
 \textcolor{keyword}{public}:
  \textcolor{comment}{}
\textcolor{comment}{  /// \(\backslash\)short Empty constructor }
\textcolor{comment}{}  TriangleMesh()
   \{
\textcolor{preprocessor}{#ifdef OOMPH\_HAS\_TRIANGLE\_LIB  }
    \textcolor{comment}{// Using this constructor no Triangulateio object is built}
    Triangulateio\_exists=\textcolor{keyword}{false};
    \textcolor{comment}{// By default allow the automatic creation of vertices along the}
    \textcolor{comment}{// boundaries by Triangle}
    this->Allow\_automatic\_creation\_of\_vertices\_on\_boundaries = \textcolor{keyword}{true};
\textcolor{preprocessor}{#ifdef OOMPH\_HAS\_MPI}
    \textcolor{comment}{// Initialize the flag to indicate this is the first time to}
    \textcolor{comment}{// compute the holes left by the halo elements}
    First\_time\_compute\_holes\_left\_by\_halo\_elements = \textcolor{keyword}{true};
\textcolor{preprocessor}{#endif // #ifdef OOMPH\_HAS\_MPI}

\textcolor{preprocessor}{#endif}

    \textcolor{comment}{// Mesh can only be built with 2D Telements.}
    MeshChecker::assert\_geometric\_element<TElementGeometricBase,ELEMENT>(2);
   \}
  \textcolor{comment}{}
\textcolor{comment}{  /// \(\backslash\)short Constructor with the input files}
\textcolor{comment}{}  TriangleMesh(\textcolor{keyword}{const} std::string& node\_file\_name,
               \textcolor{keyword}{const} std::string& element\_file\_name,
               \textcolor{keyword}{const} std::string& poly\_file\_name,
               TimeStepper* time\_stepper\_pt=
               &Mesh::Default\_TimeStepper,

\end{DoxyCodeInclude}




 

\hypertarget{index_poisson}{}\subsection{Example 1\+: A Poisson problem}\label{index_poisson}
The driver code \href{../../../../demo_drivers/meshing/mesh_from_triangle/mesh_from_triangle_poisson.cc}{\tt mesh\+\_\+from\+\_\+triangle\+\_\+poisson.\+cc} demonstrates the use of this mesh for the solution of a 2D Poisson problem in the \char`\"{}rectangular domain with a hole\char`\"{}, described in the previous section.

The code expects the names of {\ttfamily $\ast$}.{\ttfamily node}, $\ast$.{\ttfamily ele} and $\ast$.{\ttfamily poly} files generated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } as command line arguments and stores them in the namespace {\ttfamily Command\+Line\+Args} 

 
\begin{DoxyCodeInclude}
\textcolor{keywordtype}{int} \hyperlink{mesh__from__triangle__navier__stokes_8cc_a0ddf1224851353fc92bfbff6f499fa97}{main}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])
\{
 \textcolor{comment}{// Store command line arguments}
 CommandLineArgs::setup(argc,argv);

 \textcolor{comment}{// Check number of command line arguments: Need exactly two.}
 \textcolor{keywordflow}{if} (argc!=4)
  \{
   std::string error\_message =
    \textcolor{stringliteral}{"Wrong number of command line arguments.\(\backslash\)n"};
   error\_message +=
    \textcolor{stringliteral}{"Must specify the following file names  \(\backslash\)n"};
   error\_message += 
    \textcolor{stringliteral}{"filename.node then filename.ele then filename.poly\(\backslash\)n"};

   \textcolor{keywordflow}{throw} OomphLibError(error\_message,
                       OOMPH\_CURRENT\_FUNCTION,
                       OOMPH\_EXCEPTION\_LOCATION);
  \}

\end{DoxyCodeInclude}


The names of these files are then passed to the mesh constructor. Since the rest of the \href{../../../../demo_drivers/meshing/mesh_from_triangle/mesh_from_triangle_poisson.cc}{\tt driver code } is identical to that in the \href{../../../../doc/poisson/two_d_poisson/html/index.html}{\tt corresponding example with a structured mesh}, we do not provide a detailed listing but simply show the plot of the computed results, together with the tanh-\/shaped exact solution of the problem\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{sol_box}
\doxyfigcaption{Computed and exact solutions. }
\end{DoxyImage}




 

\hypertarget{index_nst}{}\subsection{Example 2\+: A Navier-\/\+Stokes problem}\label{index_nst}
The driver code \href{../../../../demo_drivers/meshing/mesh_from_triangle/mesh_from_triangle_navier_stokes.cc}{\tt mesh\+\_\+from\+\_\+triangle\+\_\+navier\+\_\+stokes.\+cc} demonstrates the use of a {\ttfamily Triangle\+Mesh} for the solution of a 2D Navier-\/\+Stokes problem. The file \href{../../../../demo_drivers/meshing/mesh_from_triangle/flow_past_box.poly}{\tt flow\+\_\+past\+\_\+box.\+poly} describes a slightly longer box-\/shaped domain with a hole -- representing a 2D channel with an obstruction. In this example the four straight line segments that bound the outer box are given distinct boundary numbers to allow the application of different boundary conditions at the inflow, the outflow, and on the upper and lower no-\/slip walls.

Here is the mesh, generated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} }

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{box_flow_mesh}
\doxyfigcaption{Unstructured mesh for the channel flow problem. }
\end{DoxyImage}


...and here is a plot of the flow field (velocity vectors, streamlines and pressure contours) computed with 2D triangular Taylor-\/\+Hood elements\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{box_flow}
\doxyfigcaption{Finite Reynolds number flow in a 2D channel with a rectangular obstacle. }
\end{DoxyImage}




 

\hypertarget{index_comments}{}\section{Comments and Exercises}\label{index_comments}
\hypertarget{index_check}{}\subsection{Checking the boundary numbers}\label{index_check}
We re-\/iterate that \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} } does not allow nodes to be located on multiple boundaries. It is therefore important to check the boundary numbers allocated by \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle} }, e.\+g. by using the function {\ttfamily Mesh\+::output\+\_\+boundaries}(...). Boundary nodes should always be placed on the boundary with the most restrictive boundary conditions. If this is not possible, some post-\/processing of the mesh may be required.\hypertarget{index_elements}{}\subsection{Higher-\/order triangles}\label{index_elements}
Currently, {\ttfamily Triangle\+Mesh} can be used to generate three, six and ten-\/node triangles (i.\+e. triangles with bi-\/linear, bi-\/quadratic and bi-\/cubic shape functions). The generation of ten-\/node triangles is currently performed somewhat inefficiently and a warning is issued. Developing a more efficient implementation should be straightforward and you are invited to perform this as an exercise.\hypertarget{index_ex}{}\subsection{Exercises}\label{index_ex}

\begin{DoxyEnumerate}
\item Download and install \href{http://www.cs.cmu.edu/~quake/triangle.html}{\tt {\ttfamily Triangle}, } and create your own meshes.
\item Experiment with the options that allow the specification of maximum areas and minimum angles.
\end{DoxyEnumerate}



 

\hypertarget{index_sources}{}\section{Source files for this tutorial}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/meshing/mesh_from_triangle/}{\tt demo\+\_\+drivers/meshing/mesh\+\_\+from\+\_\+triangle/ } \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/meshing/mesh_from_triangle/mesh_from_triangle_poisson.cc}{\tt demo\+\_\+drivers/meshing/mesh\+\_\+from\+\_\+triangle/mesh\+\_\+from\+\_\+triangle\+\_\+poisson.\+cc } \end{center} 
\end{DoxyItemize}

 

 \hypertarget{index_pdf}{}\section{P\+D\+F file}\label{index_pdf}
A \href{../latex/refman.pdf}{\tt pdf version} of this document is available. \end{document}
