This is our first Navier-\/\+Stokes example problem. We discuss the non-\/dimensionalisation of the equations and their implementation in {\ttfamily oomph-\/lib}, and demonstrate the solution of the 2D driven cavity problem.



 

\hypertarget{index_equation}{}\section{The Navier-\/\+Stokes equations}\label{index_equation}
In dimensional form the 2D \mbox{[}3D\mbox{]} Navier-\/\+Stokes equations (in cartesian coordinates $ x_i^*; \ i=1,2 [,3] $) are given by the momentum equations \begin{center} \[ \rho\left(\frac{\partial u_i^*}{\partial t^*} + u_j^*\frac{\partial u_i^*}{\partial x_j^*}\right) = - \frac{\partial p^*}{\partial x_i^*} + B_i^*(x_j^*,t^*) + \rho \, G^*_i + \frac{\partial }{\partial x_j^*} \left[ \mu\left( \frac{\partial u_i^*}{\partial x_j^*} + \frac{\partial u_j^*}{\partial x_i^*} \right) \right], \] \end{center}  and the continuity equation \begin{center} \[ \frac{\partial u_i^*}{\partial x_i^*} = Q^*, \] \end{center}  where we have used index notation and the summation convention.

Here, the velocity components are denoted by $ u_i^* $, the pressure by $ p^* $, and time by $ t^* $, and we have split the body force into two components\+: A constant vector $ \rho \, G_i^* $ which typically represents gravitational forces; and a variable body force, $ B_i^*(x^*_j,t^*) $. $ Q^*(x^*_j,t^*) $ is a volumetric source term for the continuity equation and is typically equal to zero.

We non-\/dimensionalise the equations, using problem-\/specific reference quantities for the velocity, $ {\cal U},$ length, $ {\cal L}, $ and time, ${\cal T},$ and scale the constant body force vector on the gravitational acceleration, $g, $ so that \begin{center} \[ u_i^* = {\cal U} \, u_i, \qquad x_i^* = {\cal L}\, x_i, \qquad t^* = {\cal T}\, t, \qquad G_i^* = g \, G_i, \] \[ p^* = \frac{\mu_{ref} {\cal U}}{{\cal L}} \, p, \qquad B_i^* = \frac{{\cal U}\mu_{ref}}{{\cal L}^2} \, B_i, \qquad Q^* = \frac{{\cal U}}{{\cal L}}\, Q, \qquad \] \end{center}  where we note that the pressure and the variable body force have been non-\/dimensionalised on the viscous scale. $ \mu_{ref} $ and $ \rho_{ref} $ (used below) are reference values for the fluid viscosity and density, respectively. In single-\/fluid problems, they are identical to the viscosity $ \mu $ and density $ \rho $ of the (one and only) fluid in the problem.

The non-\/dimensional form of the Navier-\/\+Stokes equations is then given by \begin{center} \[ R_\rho Re \left( St \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + B_i(x_j,t) + R_\rho \frac{Re}{Fr} G_i + \frac{\partial }{\partial x_j} \left[ R_\mu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right) \right], \] \end{center}  and \begin{center} \[ \frac{\partial u_i}{\partial x_i} = Q, \] \end{center}  where the dimensionless parameters \begin{center} \[ Re = \frac{{\cal U}{\cal L}\rho_{ref}}{\mu_{ref}}, \qquad St = \frac{{\cal L}}{{\cal U}{\cal T}}, \qquad Fr = \frac{{\cal U}^2}{g{\cal L}}, \] \end{center}  are the Reynolds number, Strouhal number and Froude number respectively. $ R_\rho=\rho/\rho_{ref} $ and $ R_\mu =\mu/\mu_{ref}$ represent the ratios of the fluid\textquotesingle{}s density and its dynamic viscosity, relative to the density and viscosity values used to form the non-\/dimensional parameters (By default, $ R_\rho = R_\mu = 1 $; other values tend to be used in problems involving multiple fluids).

The above equations are typically augmented by Dirichlet boundary conditions for (some of) the velocity components. On boundaries where no velocity boundary conditions are applied, the flow satisfies the \char`\"{}traction free\char`\"{} natural boundary condition $ t_i = -p \, n_i + R_\mu (\partial u_i/\partial x_j + \partial u_j/\partial x_i ) \, n_j = 0. $ (We refer to \href{../../rayleigh_traction_channel/html/index.html}{\tt another example } for an illustration of how to apply traction boundary conditions for the Navier-\/\+Stokes equations.)

If the velocity is prescribed along the entire domain boundary, the fluid pressure $ p $ is only determined up to an arbitrary constant. This indeterminacy may be overcome by prescribing the value of the pressure at a single point in the domain (see \href{#exercises}{\tt exercise}). 

 

\hypertarget{index_element_types}{}\section{Implementation}\label{index_element_types}


\hypertarget{index_el}{}\subsection{The elements}\label{index_el}
{\ttfamily oomph-\/lib} provides two L\+B\+B-\/stable isoparametric Navier-\/\+Stokes elements that are based on the {\ttfamily Q\+Element$<$\+D\+I\+M,3$>$} family of geometric finite elements. They are nine-\/node quadrilateral (for {\ttfamily D\+IM=2}), and 27-\/node brick (for {\ttfamily D\+IM=3}) elements in which the mapping between local and global (Eulerian) coordinates is given by \begin{center} \[ x_i = \sum_{j=1}^{N^{(E)}} X^{(E)}_{ij} \, \psi_j, \qquad i=1,2\quad [\mbox{and }3]. \] \end{center}  Here $ N^{(E)} = 3^{DIM}$ is the number of nodes in the element, $ X^{(E)}_{ij} $ is the $ i $-\/th global (Eulerian) coordinate of the $ j $-\/th {\ttfamily Node} in the element, and the $ \psi_j $ are the element\textquotesingle{}s geometric shape functions, defined in the {\ttfamily Q\+Element$<$\+D\+I\+M,3$>$} class.

In both elements the velocity components $ u_1, $ $ u_2, $ \mbox{[}and $ u_3 $\mbox{]} are stored as nodal values and the geometric shape functions are used to interpolate the velocities inside the element, \begin{center} \[ u_i = \sum_{j=1}^{N^{(E)}} U^{(E)}_{ij} \, \psi_j, \qquad i=1,2\quad [\mbox{and }3], \] \end{center}  where $ U^{(E)}_{ij} $ is the $ i $-\/th velocity component at $ j $-\/th {\ttfamily Node} in the element. Nodal values of the velocity components are accessible via the access function


\begin{DoxyCode}
NavierStokesEquations<DIM>::u(i,j)
\end{DoxyCode}


which returns the {\ttfamily i-\/th} velocity component stored at the element\textquotesingle{}s {\ttfamily j-\/th} {\ttfamily Node}.

The two elements differ in the way in which the pressure is represented\+:



\hypertarget{index_CR}{}\subsubsection{Crouzeix-\/\+Raviart elements}\label{index_CR}
In {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily Q\+Crouzeix\+Raviart\+Elements} the pressure is represented by, \begin{center} \[ p = P_0^{(E)} + P_1^{(E)} \, s_1 + P_2^{(E)} \, s_2 \quad \left[+ P_3^{(E)} \, s_3\right], \] \end{center}  where the $ s_i \in [-1,1]$ are the element\textquotesingle{}s local coordinates. This provides a discontinuous, piecewise bi-\/\mbox{[}tri-\/\mbox{]}linear representation of the pressure in terms of 3 \mbox{[}4\mbox{]} pressure degrees of freedom per element. Crouzeix-\/\+Raviart elements ensure that the continuity equation is satisfied within each element.

The pressure degrees of freedom are local to the element and are stored in the element\textquotesingle{}s internal {\ttfamily Data}. They are accessible via the member function


\begin{DoxyCode}
QCrouzeixRaviartElement<DIM>::p(j)
\end{DoxyCode}


which returns the value of the {\ttfamily j-\/th} pressure degree of freedom in this element.

Each {\ttfamily Node} in a 2D \mbox{[}3D\mbox{]} Crouzeix-\/\+Raviart element stores 2 \mbox{[}3\mbox{]} nodal values, representing the two \mbox{[}three\mbox{]} velocity components at that {\ttfamily Node}.



\hypertarget{index_TH}{}\subsubsection{Taylor-\/\+Hood elements}\label{index_TH}
In {\ttfamily oomph-\/lib\textquotesingle{}s} {\ttfamily Q\+Taylor\+Hood\+Elements} the pressure is represented by a globally-\/continuous, piecewise bi-\/\mbox{[}tri-\/\mbox{]}linear interpolation between the pressure values $ P_j^{(E)} $ that are stored at the elements\textquotesingle{} $ N_p^{(E)} = 2^{DIM}$ corner/vertex nodes, \begin{center} \[ p = \sum_{j=1}^{N_p^{(E)}} P_j^{(E)} \, \psi_j^{(p)}, \] \end{center}  where the $\psi_j^{(p)}$ are the bi-\/\mbox{[}tri-\/\mbox{]}linear pressure shape functions.

The first 2 \mbox{[}3\mbox{]} values of each {\ttfamily Node} in a 2D \mbox{[}3D\mbox{]} Taylor-\/\+Hood element store the two \mbox{[}three\mbox{]} velocity components at that {\ttfamily Node}. The corner \mbox{[}vertex\mbox{]} nodes store an additional value which represents the pressure at that {\ttfamily Node}. The access function 
\begin{DoxyCode}
QTaylorHoodElement<DIM>::p(j)
\end{DoxyCode}
 returns the nodal pressure value at the element\textquotesingle{}s {\ttfamily j-\/th} corner \mbox{[}vertex\mbox{]} {\ttfamily Node}.

In sufficiently fine meshes, Taylor-\/\+Hood elements generate a much smaller number of pressure degrees of freedom than the corresponding Crouzeix-\/\+Raviart elements. However, Taylor-\/\+Hood elements do not conserve mass locally.



\hypertarget{index_params}{}\section{Non-\/dimensional parameters and their default values}\label{index_params}
The Reynolds number, Strouhal number, inverse-\/\+Froude number, density ratio and viscosity ratio are assumed to be constant within each element. Their values are accessed via pointers which are accessible via the member functions {\ttfamily re\+\_\+pt()} for $ Re, $ {\ttfamily re\+\_\+st\+\_\+pt()} for $ Re \ St, $ {\ttfamily re\+\_\+invfr\+\_\+pt()} for $ Re/Fr, $ {\ttfamily density\+\_\+ratio\+\_\+pt()} for $ R_\rho $ and {\ttfamily viscosity\+\_\+ratio\+\_\+pt()} for $ R_\mu $.

By default the pointers point to default values (implemented as static member data in the {\ttfamily Navier\+Stokes\+Equations} class), therefore they only need to be over-\/written if the default values are not appropriate. The default values are\+:
\begin{DoxyItemize}
\item Default Reynolds number\+: \[ Re = 0 \mbox{\ \ \ \ (Stokes flow)} \]
\item Default Womersley number (product of Reynolds and Strouhal number)\+: \[ Re St = 0 \mbox{\ \ \ \ (steady flow)} \]
\item Default product of Reynolds and inverse Froude number (a measure of gravity on the viscous scale) \[ Re/Fr = 0 \mbox{\ \ \ \ (no gravity)} \]
\item Default viscosity ratio\+: \[ R_\mu = 1 \mbox{\ \ \ \ (viscosity = viscosity used in the definition of $Re$)} \]
\item Default density ratio\+: \[ R_\rho = 1 \mbox{\ \ \ \ (density = density used in the definition of $Re$)} \]
\end{DoxyItemize}We use the same approach for the specification of the body force vector $ G_i $, accessible via the function {\ttfamily g\+\_\+pt} (), the variable body force $ B_i $, accessible via the function pointer {\ttfamily body\+\_\+force\+\_\+fct\+\_\+pt()}, and the volumetric source function $ Q $, accessible via the function pointer {\ttfamily source\+\_\+fct\+\_\+pt(time,x)}. By default the (function) pointers are set such that
\begin{DoxyItemize}
\item Default gravity vector\+: \[ G_i = 0 \mbox{\ \ \ \ (no gravity)} \]
\item Default body force function\+: \[ B_i(x_j,t) = 0 \mbox{\ \ \ \ (no body force)} \]
\item Default volumetric source function \[ Q(x_j,t) = 0 \mbox{\ \ \ \ (flow is divergence free)} \]
\end{DoxyItemize}

 

\hypertarget{index_example}{}\section{The example problem}\label{index_example}
We will illustrate the solution of the steady 2D Navier-\/\+Stokes equations using the well-\/known example of the driven cavity.

\begin{center} \tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*{1}{|X[-1]}|}
\hline
\begin{center} {\bfseries The 2D steady driven-\/cavity problem in a square domain.} \end{center}  Solve \[ Re\phantom{i}u_j\frac{\partial u_i}{\partial x_j} = - \frac{\partial p}{\partial x_i} + \frac{\partial }{\partial x_j} \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right), \ \ \ \ \ \ \ \ \ \ (1) \] and \[ \frac{\partial u_i}{\partial x_i} = 0, \] in the square domain $ D = \{x_i \in [0,1]; i=1,2 \} $, subject to the Dirichlet boundary conditions\+: \[ \left. \mathbf{u}\right|_{\partial D}=(0,0), \ \ \ \ \ \ \ \ \ \ (2) \] on the right, top and left boundaries and \[ \left. \mathbf{u}\right|_{\partial D}=(1,0), \ \ \ \ \ \ \ \ \ \ (3) \] on the bottom boundary, $ x_2=0.$   \\\cline{1-1}
\end{longtabu}
\end{center} 



 

\hypertarget{index_results}{}\section{Results}\label{index_results}
\hypertarget{index_results_CR}{}\subsection{Crouzeix-\/\+Raviart elements}\label{index_results_CR}
The figure below shows \char`\"{}carpet plots\char`\"{} of the velocity and pressure fields as well as a contour plot of the pressure distribution with superimposed streamlines. The velocity vanishes along the entire domain boundary, apart from the bottom boundary $ (x_2=0) $ where the moving \char`\"{}lid\char`\"{} imposes a unit tangential velocity which drives a large vortex, centred at $ (x_1,x_2) \approx (0.62,0.26)$. The discontinuity in the velocity boundary conditions creates pressure singularities at $ (x_1,x_2) = (0,0)$ and $ (x_1,x_2) = (1,0)$. The rapidly varying pressure in the vicinity of these points clearly shows the discontinuous pressure interpolation employed by the Crouzeix-\/\+Raviart elements.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{CrouzeixRaviart}
\doxyfigcaption{Plot of the velocity and pressure fields for Re=100 computed with Crouzeix-\/\+Raviart (Q2\+P-\/1) elements. }
\end{DoxyImage}
\hypertarget{index_results_TH}{}\subsection{Taylor-\/\+Hood elements}\label{index_results_TH}
The next figure shows the corresponding results obtained from a computation with {\ttfamily Q\+Taylor\+Hood\+Elements}. The pressure plot illustrates how the interpolation between the corner nodes creates a globally continuous representation of the pressure.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{TaylorHood}
\doxyfigcaption{Plot of the velocity and pressure fields for Re=100 computed with Taylor-\/\+Hood (Q2\+Q1) elements. }
\end{DoxyImage}


Note that in both simulations, the flow field is clearly under-\/resolved near the ends of the \char`\"{}lid\char`\"{}. In \href{../../adaptive_driven_cavity/html/index.html}{\tt another example} we will demonstrate the use of spatial adaptivity to obtain much better solutions for this problem.



 

\hypertarget{index_namespace}{}\section{Global parameters and functions}\label{index_namespace}
The Reynolds number is the only non-\/dimensional parameter needed in this problem. As usual, we define it in a namespace\+:

 
\begin{DoxyCodeInclude}
\textcolor{comment}{//==start\_of\_namespace==============================}
\textcolor{comment}{/// Namespace for physical parameters}
\textcolor{comment}{}\textcolor{comment}{//==================================================}
\textcolor{keyword}{namespace }\hyperlink{namespaceGlobal__Physical__Variables}{Global\_Physical\_Variables}
\{
\textcolor{comment}{}
\textcolor{comment}{ /// Reynolds number}
\textcolor{comment}{} \textcolor{keywordtype}{double} \hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Re}=100;

\} \textcolor{comment}{// end\_of\_namespace}

\end{DoxyCodeInclude}




 

\hypertarget{index_main}{}\section{The driver code}\label{index_main}
We start by creating a {\ttfamily Doc\+Info} object to store the output directory and the label for the output files.


\begin{DoxyCodeInclude}
\textcolor{comment}{//==start\_of\_main======================================================}
\textcolor{comment}{/// Driver for RectangularDrivenCavity test problem -- test drive}
\textcolor{comment}{}\textcolor{comment}{/// with two different types of element.}
\textcolor{comment}{}\textcolor{comment}{//=====================================================================}
\textcolor{keywordtype}{int} \hyperlink{driven__cavity_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}()
\{

 \textcolor{comment}{// Set up doc info}
 \textcolor{comment}{// ---------------}

 \textcolor{comment}{// Label for output}
 DocInfo doc\_info;
 
 \textcolor{comment}{// Set output directory}
 doc\_info.set\_directory(\textcolor{stringliteral}{"RESLT"});
 
 \textcolor{comment}{// Step number}
 doc\_info.number()=0;

\end{DoxyCodeInclude}


We build the problem using {\ttfamily Q\+Crouzeix\+Raviart\+Elements}, solve using the {\ttfamily Problem\+::newton\+\_\+solve()} function, and document the result before incrementing the label for the output files.


\begin{DoxyCodeInclude}
 \textcolor{comment}{// Doing QCrouzeixRaviartElements}
 \{
  
  \textcolor{comment}{// Build the problem with QCrouzeixRaviartElements}
  \hyperlink{classRectangularDrivenCavityProblem}{RectangularDrivenCavityProblem<QCrouzeixRaviartElement<2>}
       > problem;
  cout << \textcolor{stringliteral}{"Doing QCrouzeixRaviartElement<2>"} << std::endl;
  
  \textcolor{comment}{// Solve the problem}
  problem.newton\_solve();
  
  \textcolor{comment}{// Outpt the solution}
  problem.\hyperlink{classRectangularDrivenCavityProblem_ab9540b4f539b7d62a1165cc42b4190ea}{doc\_solution}(doc\_info);

  \textcolor{comment}{// Step number}
  doc\_info.number()++;

 \} \textcolor{comment}{// end of QCrouzeixRaviartElements}

\end{DoxyCodeInclude}


Finally, we repeat the process with {\ttfamily Q\+Taylor\+Hood\+Elements}.


\begin{DoxyCodeInclude}
 \textcolor{comment}{// Doing QTaylorHoodElements}
 \{
  
  \textcolor{comment}{// Build the problem with QTaylorHoodElements}
  \hyperlink{classRectangularDrivenCavityProblem}{RectangularDrivenCavityProblem<QTaylorHoodElement<2>} 
      > problem;
  cout << \textcolor{stringliteral}{"Doing QTaylorHoodElement<2>"} << std::endl;
  
  \textcolor{comment}{// Solve the problem}
  problem.newton\_solve();
  
  \textcolor{comment}{// Outpt the solution}
  problem.\hyperlink{classRectangularDrivenCavityProblem_ab9540b4f539b7d62a1165cc42b4190ea}{doc\_solution}(doc\_info);

  \textcolor{comment}{// Step number}
  doc\_info.number()++;

 \} \textcolor{comment}{// end of QTaylorHoodElements}


\} \textcolor{comment}{// end\_of\_main}

\end{DoxyCodeInclude}




 

\hypertarget{index_problem}{}\section{The problem class}\label{index_problem}
The {\ttfamily Problem} class for our steady Navier-\/\+Stokes problem is very similar to those used for the steady scalar problems (Poisson and advection-\/diffusion) that we considered in previous examples. We provide a helper function {\ttfamily fix\+\_\+pressure}(...) which pins a pressure value in a specified element and assigns a specific value.

 
\begin{DoxyCodeInclude}
\textcolor{comment}{//==start\_of\_problem\_class============================================}
\textcolor{comment}{/// Driven cavity problem in rectangular domain}
\textcolor{comment}{}\textcolor{comment}{//====================================================================}
\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>
\textcolor{keyword}{class }\hyperlink{classRectangularDrivenCavityProblem}{RectangularDrivenCavityProblem} : \textcolor{keyword}{public} Problem
\{

\textcolor{keyword}{public}:

\textcolor{comment}{}
\textcolor{comment}{ /// Constructor}
\textcolor{comment}{} \hyperlink{classRectangularDrivenCavityProblem_ad7382f68a780f86ea5f0e9b7d4d119ec}{RectangularDrivenCavityProblem}();
\textcolor{comment}{}
\textcolor{comment}{ /// Destructor (empty)}
\textcolor{comment}{} \hyperlink{classRectangularDrivenCavityProblem_a0233981e33e2bd9db424b19e51a0faef}{~RectangularDrivenCavityProblem}()\{\}
\textcolor{comment}{}
\textcolor{comment}{ ///Fix pressure in element e at pressure dof pdof and set to pvalue}
\textcolor{comment}{} \textcolor{keywordtype}{void} \hyperlink{classRectangularDrivenCavityProblem_ac02d80f5241eeb04571577ce3b9f35a3}{fix\_pressure}(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} &e, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} &pdof, 
                   \textcolor{keyword}{const} \textcolor{keywordtype}{double} &pvalue)
  \{
   \textcolor{comment}{//Cast to full element type and fix the pressure at that element}
   \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(\hyperlink{classRectangularDrivenCavityProblem_a408035d1f224641db75a2f48074e9593}{mesh\_pt}()->element\_pt(e))->
                          \hyperlink{classRectangularDrivenCavityProblem_ac02d80f5241eeb04571577ce3b9f35a3}{fix\_pressure}(pdof,pvalue);
  \} \textcolor{comment}{// end of fix\_pressure}

\end{DoxyCodeInclude}


No actions are performed after the solution is found, since the solution is documented in {\ttfamily main}. However, before solving, the boundary conditions must be set.


\begin{DoxyCodeInclude}
 \textcolor{comment}{/// Update the after solve (empty)}
 \textcolor{keywordtype}{void} actions\_after\_newton\_solve()\{\}

\textcolor{comment}{}
\textcolor{comment}{ /// \(\backslash\)short Update the problem specs before solve. }
\textcolor{comment}{ /// Re-set velocity boundary conditions just to be on the safe side...}
\textcolor{comment}{} \textcolor{keywordtype}{void} actions\_before\_newton\_solve()
 \{
  \textcolor{comment}{// Setup tangential flow along boundary 0:}
  \textcolor{keywordtype}{unsigned} ibound=0; 
  \textcolor{keywordtype}{unsigned} num\_nod= mesh\_pt()->nboundary\_node(ibound);
  \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)
   \{
    \textcolor{comment}{// Tangential flow}
    \textcolor{keywordtype}{unsigned} i=0;
    mesh\_pt()->boundary\_node\_pt(ibound,inod)->set\_value(i,1.0);
    \textcolor{comment}{// No penetration}
    i=1;
    mesh\_pt()->boundary\_node\_pt(ibound,inod)->set\_value(i,0.0);
   \}
  
  \textcolor{comment}{// Overwrite with no flow along the other boundaries}
  \textcolor{keywordtype}{unsigned} num\_bound = mesh\_pt()->nboundary();
  \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} ibound=1;ibound<num\_bound;ibound++)
   \{
    \textcolor{keywordtype}{unsigned} num\_nod= mesh\_pt()->nboundary\_node(ibound);
    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)
     \{
      \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i=0;i<2;i++)
       \{
        mesh\_pt()->boundary\_node\_pt(ibound,inod)->set\_value(i,0.0);
       \}
     \}
   \}
 \} \textcolor{comment}{// end\_of\_actions\_before\_newton\_solve}

\end{DoxyCodeInclude}


Finally, we provide an access function to the specific mesh and define the post-\/processing function {\ttfamily doc\+\_\+solution}(...).


\begin{DoxyCodeInclude}
 \textcolor{comment}{// Access function for the specific mesh}
 SimpleRectangularQuadMesh<ELEMENT>* mesh\_pt() 
  \{
   \textcolor{comment}{// Upcast from pointer to the Mesh base class to the specific }
   \textcolor{comment}{// element type that we're using here.}
   \textcolor{keywordflow}{return} \textcolor{keyword}{dynamic\_cast<}SimpleRectangularQuadMesh<ELEMENT>*\textcolor{keyword}{>}(
    Problem::mesh\_pt());
  \}

\textcolor{comment}{}
\textcolor{comment}{ /// Doc the solution}
\textcolor{comment}{} \textcolor{keywordtype}{void} doc\_solution(DocInfo& doc\_info);

\}; \textcolor{comment}{// end\_of\_problem\_class}

\end{DoxyCodeInclude}




 

\hypertarget{index_constructor}{}\section{The problem constructor}\label{index_constructor}
Since this is a steady problem, the constructor is quite simple. We begin by building the mesh and pin the velocities on the boundaries.


\begin{DoxyCodeInclude}
\textcolor{comment}{//==start\_of\_constructor==================================================}
\textcolor{comment}{/// Constructor for RectangularDrivenCavity problem }
\textcolor{comment}{}\textcolor{comment}{//========================================================================}
\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>
\hyperlink{classRectangularDrivenCavityProblem_ad7382f68a780f86ea5f0e9b7d4d119ec}{RectangularDrivenCavityProblem<ELEMENT>::RectangularDrivenCavityProblem}
      ()
\{ 

 \textcolor{comment}{// Setup mesh}

 \textcolor{comment}{// # of elements in x-direction}
 \textcolor{keywordtype}{unsigned} n\_x=10;

 \textcolor{comment}{// # of elements in y-direction}
 \textcolor{keywordtype}{unsigned} n\_y=10;

 \textcolor{comment}{// Domain length in x-direction}
 \textcolor{keywordtype}{double} l\_x=1.0;

 \textcolor{comment}{// Domain length in y-direction}
 \textcolor{keywordtype}{double} l\_y=1.0;

 \textcolor{comment}{// Build and assign mesh}
 Problem::mesh\_pt() = \textcolor{keyword}{new} SimpleRectangularQuadMesh<ELEMENT>(n\_x,n\_y,l\_x,l\_y);

 \textcolor{comment}{// Set the boundary conditions for this problem: All nodes are}
 \textcolor{comment}{// free by default -- just pin the ones that have Dirichlet conditions}
 \textcolor{comment}{// here. }
 \textcolor{keywordtype}{unsigned} num\_bound = mesh\_pt()->nboundary();
 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} ibound=0;ibound<num\_bound;ibound++)
  \{
   \textcolor{keywordtype}{unsigned} num\_nod= mesh\_pt()->nboundary\_node(ibound);
   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} inod=0;inod<num\_nod;inod++)
    \{
     \textcolor{comment}{// Loop over values (u and v velocities)}
     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} i=0;i<2;i++)
      \{
       mesh\_pt()->boundary\_node\_pt(ibound,inod)->pin(i); 
      \}
    \}
  \} \textcolor{comment}{// end loop over boundaries}

\end{DoxyCodeInclude}


Next we pass a pointer to the Reynolds number (stored in {\ttfamily \hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\+\_\+\+Physical\+\_\+\+Variables\+::\+Re}}) to all elements.


\begin{DoxyCodeInclude}
 \textcolor{comment}{// Complete the build of all elements so they are fully functional}

 \textcolor{comment}{//Find number of elements in mesh}
 \textcolor{keywordtype}{unsigned} n\_element = mesh\_pt()->nelement();

 \textcolor{comment}{// Loop over the elements to set up element-specific }
 \textcolor{comment}{// things that cannot be handled by constructor}
 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{unsigned} e=0;e<n\_element;e++)
  \{
   \textcolor{comment}{// Upcast from GeneralisedElement to the present element}
   ELEMENT* el\_pt = \textcolor{keyword}{dynamic\_cast<}ELEMENT*\textcolor{keyword}{>}(mesh\_pt()->element\_pt(e));

   \textcolor{comment}{//Set the Reynolds number}
   el\_pt->re\_pt() = &\hyperlink{namespaceGlobal__Physical__Variables_ab814e627d2eb5bc50318879d19ab16b9}{Global\_Physical\_Variables::Re};
  \} \textcolor{comment}{// end loop over elements}

\end{DoxyCodeInclude}


Since Dirichlet conditions are applied to both velocity components on all boundaries, the pressure is only determined up to an arbitrary constant. We use the {\ttfamily fix\+\_\+pressure}(...) function to pin the first pressure value in the first element and set its value to zero.


\begin{DoxyCodeInclude}
 \textcolor{comment}{// Now set the first pressure value in element 0 to 0.0}
 fix\_pressure(0,0,0.0);

\end{DoxyCodeInclude}


Finally, the equation numbering scheme is set up, using the function {\ttfamily assign\+\_\+eqn\+\_\+numbers()}.


\begin{DoxyCodeInclude}
 \textcolor{comment}{// Setup equation numbering scheme}
 cout <<\textcolor{stringliteral}{"Number of equations: "} << assign\_eqn\_numbers() << std::endl; 
\} \textcolor{comment}{// end\_of\_constructor}

\end{DoxyCodeInclude}




 

\hypertarget{index_doc}{}\section{Post-\/processing}\label{index_doc}
As expected, this member function documents the computed solution.


\begin{DoxyCodeInclude}
\textcolor{comment}{//==start\_of\_doc\_solution=================================================}
\textcolor{comment}{/// Doc the solution}
\textcolor{comment}{}\textcolor{comment}{//========================================================================}
\textcolor{keyword}{template}<\textcolor{keyword}{class} ELEMENT>
\textcolor{keywordtype}{void} \hyperlink{classRectangularDrivenCavityProblem_ab9540b4f539b7d62a1165cc42b4190ea}{RectangularDrivenCavityProblem<ELEMENT>::doc\_solution}
      (DocInfo& doc\_info)
\{ 
 ofstream some\_file;
 \textcolor{keywordtype}{char} filename[100];

 \textcolor{comment}{// Number of plot points}
 \textcolor{keywordtype}{unsigned} npts;
 npts=5; 

 \textcolor{comment}{// Output solution }
 sprintf(filename,\textcolor{stringliteral}{"%s/soln%i.dat"},doc\_info.directory().c\_str(),
         doc\_info.number());
 some\_file.open(filename);
 mesh\_pt()->output(some\_file,npts);
 some\_file.close();
\} \textcolor{comment}{// end\_of\_doc\_solution}

\end{DoxyCodeInclude}




 

\hypertarget{index_comments}{}\section{Comments and Exercises}\label{index_comments}
\hypertarget{index_stress_divergence}{}\subsection{The stress-\/divergence form}\label{index_stress_divergence}
As discussed in the introduction, by default {\ttfamily oomph-\/lib\textquotesingle{}s} Navier-\/\+Stokes elements use the stress-\/divergence form of the momentum equations, \begin{center} \[ R_\rho Re \left( St \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + B_i(x_j) + R_\rho \frac{Re}{Fr} G_i + \frac{\partial }{\partial x_j} \left[ R_\mu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right) \right], \] \end{center}  as this form is required in problems with free surfaces or problems in which traction boundary conditions are applied.

If the flow is divergence free ( $ Q = 0 \Longrightarrow \partial u_i/\partial x_i =0$), the viscous term may be simplified to \begin{center} \[ R_\rho Re \left( St \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} \right) = - \frac{\partial p}{\partial x_i} + B_i(x_j) + R_\rho \frac{Re}{Fr} G_i + R_\mu \frac{\partial^2 u_i }{\partial x_j^2}, \] \end{center}  assuming that the viscosity ratio $ R_\mu $ remains constant

This simpler form of the equations can be used to solve problems that do not incorporate traction boundaries or free surfaces. We illustrate the use of these equations in \href{../../circular_driven_cavity/html/index.html}{\tt another example.}\hypertarget{index_exercises}{}\subsection{Exercises}\label{index_exercises}

\begin{DoxyEnumerate}
\item Compare the pressure distributions obtained with Taylor-\/\+Hood elements to that computed with Crouzeix-\/\+Raviart elements. Why do they differ? \mbox{[}Hint\+: Consider how the pressure is represented in the two elements.\mbox{]}
\item Confirm that the velocities stored at boundary nodes must be pinned. Investigate what happens if you do not apply {\itshape any} velocity boundary conditions \mbox{[}Hint\+: You should still be able to compute a solution -- what does this solution represent?\mbox{]}
\item Investigate what happens when no pressure value is fixed.
\end{DoxyEnumerate}



 

\hypertarget{index_sources}{}\section{Source files for this tutorial}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+: \begin{center} \href{../../../../demo_drivers/navier_stokes/driven_cavity/}{\tt demo\+\_\+drivers/navier\+\_\+stokes/driven\+\_\+cavity/ } \end{center} 
\item The driver code is\+: \begin{center} \href{../../../../demo_drivers/navier_stokes/driven_cavity/driven_cavity.cc}{\tt demo\+\_\+drivers/navier\+\_\+stokes/driven\+\_\+cavity/driven\+\_\+cavity.\+cc } \end{center} 
\end{DoxyItemize}



 

 \hypertarget{index_pdf}{}\section{P\+D\+F file}\label{index_pdf}
A \href{../latex/refman.pdf}{\tt pdf version} of this document is available. \end{document}
