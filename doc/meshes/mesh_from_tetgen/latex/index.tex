In this document we demonstrate how to generate unstructured tetrahedral meshes for {\ttfamily oomph-\/lib}, based on the output from \href{http://www.wias-berlin.de/~si }{\tt Hang Si\textquotesingle{}s} open-\/source mesh generator \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} }. The mesh generation is performed in a two-\/stage process. First we use \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } to generate the mesh \char`\"{}offline\char`\"{}. Then we process the output files generated by \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } to generate an {\ttfamily oomph-\/lib} mesh.



 

\hypertarget{index_Tetgen_use}{}\section{Quick guide for the use of Tetgen}\label{index_Tetgen_use}
The \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} home page } contains a comprehensive User\textquotesingle{}s Guide for the code and its many options, therefore we only present a brief overview of the code\textquotesingle{}s most basic usage.

\href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } creates the mesh based on the information about the mesh boundaries provided in an input file, {\ttfamily filename.\+poly}, say. By default, three output files, {\ttfamily filename.\+1.\+node}, {\ttfamily filename.\+1.\+ele}, and {\ttfamily filename.\+1.\+face} are created. They contain the information about the nodal positions, the element connectivity lists and the boundary faces respectively.



\hypertarget{index_input}{}\subsection{The input file format}\label{index_input}
The input file for \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } usually has the extension {\ttfamily $\ast$}.{\ttfamily poly} and has the following format\+:

\tabulinesep=1mm
\begin{longtabu} spread 0pt [c]{*{1}{|X[-1]}|}
\hline


{\bfseries  Node list }

First line\+: \mbox{[}number of nodes\mbox{]} \mbox{[}dimension (must be 3)\mbox{]} \mbox{[}number of attributes\mbox{]} \mbox{[}number of boundary markers (0 or 1)\mbox{]} ~\newline
Remaining lines\+: \mbox{[}node index\mbox{]} \mbox{[}x\mbox{]} \mbox{[}y\mbox{]} \mbox{[}z\mbox{]} \mbox{[}\mbox{[}attributes\mbox{]}\mbox{]} \mbox{[}\mbox{[}boundary marker\mbox{]}\mbox{]} ~\newline
 {\bfseries  Facet list }

One line\+: \mbox{[}number of facets\mbox{]} \mbox{[}boundary markers (0 or 1)\mbox{]} ~\newline
Following lines are a list of the facets\+: \mbox{[}facet index\mbox{]} ~\newline
 where each facet has the following format\+: ~\newline
 One line\+: \mbox{[}number of polygons\mbox{]} \mbox{[}\mbox{[}number of holes\mbox{]}\mbox{]} \mbox{[}\mbox{[}boundary marker\mbox{]}\mbox{]} ~\newline
 Following lines\+: \mbox{[}number of corners\mbox{]} \mbox{[}corner 1\mbox{]} \mbox{[}corner 2\mbox{]} ... \mbox{[}last corner\mbox{]} ~\newline
 Following lines\+: \mbox{[}hole index\mbox{]} \mbox{[}x\mbox{]} \mbox{[}y\mbox{]} \mbox{[}z\mbox{]} ~\newline
 {\bfseries  Hole list }

One line\+: \mbox{[}number of holes\mbox{]} ~\newline
Following lines\+: \mbox{[}hole index\mbox{]} \mbox{[}x\mbox{]} \mbox{[}y\mbox{]} \mbox{[}z\mbox{]}

{\bfseries  Region attributes list }

One line\+: \mbox{[}number of region\mbox{]} ~\newline
Following lines\+: \mbox{[}region index\mbox{]} \mbox{[}x\mbox{]} \mbox{[}y\mbox{]} \mbox{[}z\mbox{]} \mbox{[}region number\mbox{]} \mbox{[}region attribute\mbox{]}

\\\cline{1-1}
\end{longtabu}


{\bfseries Comments\+:} 
\begin{DoxyItemize}
\item The data between \mbox{[} \mbox{]} must be provided. The attributes and boundary markers must only be specified if the corresponding number of boundary markers or the number of attributes is nonzero. ~\newline
 ~\newline

\item Boundary markers can be used to identify which nodes are located on which domain boundaries. If domain boundaries are to be identified the number of boundary markers should be set to 1, otherwise it must be set to zero. If the number of boundary markers is set to 1, boundary markers must be specified for every node and facet. A boundary marker 0 should be used for nodes that are not located on domain boundaries; a boundary marker {\ttfamily b+1} should be used to indicate that a node is located on the mesh boundary {\ttfamily b} in the final {\ttfamily oomph-\/lib} mesh.
\item {\ttfamily oomph-\/lib} does not use the \char`\"{}attributes\char`\"{} so their number should be set to zero.
\item The boundary markers have to be specified in the node list A\+ND in the facet list.
\item If a node is located on multiple boundaries, the boundary marker of the node is chosen arbitrarily.
\item Holes are identified by the coordinates of a single point in their interior. The holes in the facet list are holes in the facet, they are different from the holes in the hole list, which are holes in the volume.
\end{DoxyItemize}

See the \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} home page } for further information.



\hypertarget{index_run_Tetgen}{}\subsection{How to run Tetgen}\label{index_run_Tetgen}
To create the mesh from a given input file the command is 
\begin{DoxyCode}
./tetgen filename.poly
\end{DoxyCode}


With these commands, \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } will generate as few tetrahedra as possible. Finer meshes may be generated by imposing additional constraints via command line arguments. For instance
\begin{DoxyItemize}
\item A maximum tetrahedron volume can be specified with {\ttfamily -\/a}{\itshape n} where {\itshape n} is the maximal volume wanted. (There is no space between {\ttfamily -\/a} and the number specifying the volume!)
\item ...
\end{DoxyItemize}

Again, we refer to the \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} home page } for a comprehensive listing of all available options.



\hypertarget{index_tetview}{}\subsection{How to visualise a mesh generated by Tetgen}\label{index_tetview}
To visualise the mesh, the program {\ttfamily tetview} (distributed with \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} }) can be used.



\hypertarget{index_example}{}\section{An example\+: A cube with a cube hole}\label{index_example}
To illustrate the procedure, we demonstrate how to generate a mesh for the cube domain with a hole shown in the figure below. Note that the node numbers correspond to those in the \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } input file. Boundary 1 is shown in blue; boundary 2 in magenta. In the corresponding {\ttfamily oomph-\/lib} mesh, the boundaries are numbered from zero.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{cube_hole}
\doxyfigcaption{the cube with a hole domain }
\end{DoxyImage}


Here is a listing of the corresponding input file, {\ttfamily cube\+\_\+hole.\+poly\+:} 


\begin{DoxyCodeInclude}
# This file represents a cube with a cube hole in the middle.

# Part 1 - node list
16 3 0 1
1    0 0 0 1
2    3 0 0 1 
3    3 3 0 1
4    0 3 0 1
5    0 0 3 1
6    3 0 3 1
7    3 3 3 1
8    0 3 3 1
9    1 1 1 2
10   2 1 1 2
11   2 2 1 2
12   1 2 1 2
13   1 1 2 2
14   2 1 2 2
15   2 2 2 2
16   1 2 2 2

# Part 2 - facet list
12 1
# bottom 1
1 0 1
4 1 2 3 4
# top 1
1 0 1
4 5 6 7 8
# left 1
1 0 1
4 1 4 8 5
# right 1
1 0 1
4 2 3 7 6
# front 1
1 0 1
4 3 4 8 7
# back 1
1 0 1
4 1 2 6 5
# bottom 2
1 0 2
4 9 10 11 12
# top 2
1 0 2
4 13 14 15 16
# left 2
1 0 2
4 9 12 16 13
# right 2
1 0 2
4 10 11 15 14
# front 2
1 0 2
4 11 12 16 15
# back 2
1 0 2
4 9 10 14 13

# Part 3 - hole list
1
1 1.5 1.5 1.5 

# Part 4 - region list
0
\end{DoxyCodeInclude}


The output files that \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } creates with the command 
\begin{DoxyCode}
./tetgen  -a0.2 cube\_hole.poly 
\end{DoxyCode}
 are \href{../../../../demo_drivers/meshing/mesh_from_tetgen/cube_hole.1.node}{\tt cube\+\_\+hole.\+1.\+node} , \href{../../../../demo_drivers/meshing/mesh_from_tetgen/cube_hole.1.ele}{\tt cube\+\_\+hole.\+1.\+ele} and \href{../../../../demo_drivers/meshing/mesh_from_tetgen/cube_hole.1.face}{\tt cube\+\_\+hole.\+1.\+face}.

Here is a sketch of the resulting discretisation, as displayed by {\ttfamily tetview} \+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{tetview_screenshot}
\doxyfigcaption{Cut plane of the tetrahedral mesh. }
\end{DoxyImage}




\hypertarget{index_oomph_use}{}\section{Creating an oomph-\/lib mesh based on output files generated by Tetgen}\label{index_oomph_use}
{\ttfamily oomph-\/lib} provides a mesh, {\ttfamily Tetgen\+Mesh}, that uses the output from \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } to generate an unstructured {\ttfamily oomph-\/lib} Mesh containing elements from the {\ttfamily T\+Element$<$3,\+N\+N\+O\+D\+E\+\_\+1\+D$>$} family of the tetrahedral elements. The relevant interface is\+:

 
\begin{DoxyCodeInclude}
\textcolor{comment}{//=========start of TetgenMesh class======================================}
\textcolor{comment}{/// \(\backslash\)short  Unstructured tet mesh based on output from Tetgen:}
\textcolor{comment}{}\textcolor{comment}{/// http://wias-berlin.de/software/tetgen/}
\textcolor{comment}{}\textcolor{comment}{//========================================================================}
\textcolor{keyword}{template} <\textcolor{keyword}{class} ELEMENT>
\textcolor{keyword}{class }TetgenMesh : \textcolor{keyword}{public} \textcolor{keyword}{virtual} TetMeshBase
\{

\textcolor{keyword}{public}:
\textcolor{comment}{}
\textcolor{comment}{ /// \(\backslash\)short Empty constructor}
\textcolor{comment}{} TetgenMesh()
  \{
   \textcolor{comment}{// Mesh can only be built with 3D Telements.}
   MeshChecker::assert\_geometric\_element<TElementGeometricBase,ELEMENT>(3);
  \}
\textcolor{comment}{}
\textcolor{comment}{ /// \(\backslash\)short Constructor with the input files}
\textcolor{comment}{} TetgenMesh(\textcolor{keyword}{const} std::string& node\_file\_name,
            \textcolor{keyword}{const} std::string& element\_file\_name,
            \textcolor{keyword}{const} std::string& face\_file\_name,
            TimeStepper* time\_stepper\_pt=
            &Mesh::Default\_TimeStepper,

\end{DoxyCodeInclude}




 

\hypertarget{index_poisson}{}\subsection{Example 1\+: A Poisson problem}\label{index_poisson}
The driver code \href{../../../../demo_drivers/meshing/mesh_from_tetgen/mesh_from_tetgen_poisson.cc}{\tt mesh\+\_\+from\+\_\+tetgen\+\_\+poisson.\+cc} demonstrates the use of this mesh for the solution of a 3D Poisson problem in the \char`\"{}cube domain with a hole\char`\"{}, described in the previous section.

The code expects the names of {\ttfamily $\ast$}.{\ttfamily node}, $\ast$.{\ttfamily ele} and $\ast$.{\ttfamily face} files generated by \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } as command line arguments and stores them in the namespace {\ttfamily Command\+Line\+Args} 

 
\begin{DoxyCodeInclude}
\textcolor{keywordtype}{int} \hyperlink{mesh__from__tetgen__navier__stokes_8cc_a0ddf1224851353fc92bfbff6f499fa97}{main}(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])
\{
 
\textcolor{comment}{// Store command line arguments}
 CommandLineArgs::setup(argc,argv);

 \textcolor{comment}{// Check number of command line arguments: Need exactly three.}
 \textcolor{keywordflow}{if} (argc!=4)
  \{
   std::string error\_message =
    \textcolor{stringliteral}{"Wrong number of command line arguments.\(\backslash\)n"};
   error\_message +=
    \textcolor{stringliteral}{"Must specify the following file names  \(\backslash\)n"};
   error\_message += 
    \textcolor{stringliteral}{"filename.node then filename.ele then filename.face\(\backslash\)n"};

   \textcolor{keywordflow}{throw} OomphLibError(error\_message,
                       OOMPH\_CURRENT\_FUNCTION,
                       OOMPH\_EXCEPTION\_LOCATION);
  \}

\end{DoxyCodeInclude}


The names of these files are then passed to the mesh constructor. Since the rest of the \href{../../../../demo_drivers/meshing/mesh_from_tetgen/mesh_from_tetgen_poisson.cc}{\tt driver code } is identical to that in the \href{../../../../doc/poisson/eighth_sphere_poisson/html/index.html}{\tt corresponding example with a structured mesh}, we do not provide a detailed listing but simply show the plot of the computed results, together with a plot of the exact solution, for linear (four-\/noded) elements

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{compare_linear}
\doxyfigcaption{FE and exact solution with linear elements. }
\end{DoxyImage}
 ...and quadratic (ten-\/noded) elements\+:

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{compare_quadratic}
\doxyfigcaption{FE and exact solution with quadratic elements. }
\end{DoxyImage}




 

\hypertarget{index_nst}{}\subsection{Example 2\+: A Navier-\/\+Stokes problem}\label{index_nst}
The driver code \href{../../../../demo_drivers/meshing/mesh_from_tetgen/mesh_from_tetgen_navier_stokes.cc}{\tt mesh\+\_\+from\+\_\+tetgen\+\_\+navier\+\_\+stokes.\+cc} demonstrates the use of a {\ttfamily Tetgen\+Mesh} for the solution of a 3D Navier-\/\+Stokes problem in the same geometry as in the previous example. We apply no-\/slip boundary conditions on the central hole and impose a unit vertical velocity. On the outer boundaries we pin the $ y $ and $ z $ velocity components and set them to zero, while leaving the axial velocity unspecified. The resulting flow field, shown in the figure below, corresponds to the flow that is generated when the rigid block in the centre of the domain rises vertically inside a rigid duct with \char`\"{}slippery walls\char`\"{}. The duct is open at the ends $ x=const$, where parallel, axially-\/traction free outflow is imposed. The various slices show pressure contours and the in-\/plane velocity vectors.

 
\begin{DoxyImage}
\includegraphics[width=0.75\textwidth]{flow}
\doxyfigcaption{Flow in a duct with slippery walls, driven by the vertical motion of the central block. }
\end{DoxyImage}




 

\hypertarget{index_comments}{}\section{Comments and Exercises}\label{index_comments}
\hypertarget{index_check}{}\subsection{Checking the boundary numbers}\label{index_check}
We re-\/iterate that \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} } does not allow nodes to be located on multiple boundaries. It is therefore important to check the boundary numbers allocated by \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen} }, e.\+g. by using the function {\ttfamily Mesh\+::output\+\_\+boundaries}(...). Boundary nodes should always be placed on the boundary with the most restrictive boundary conditions. If this is not possible, some post-\/processing of the mesh may be required.\hypertarget{index_elements}{}\subsection{Higher-\/order tets}\label{index_elements}
Currently, {\ttfamily Tetgen\+Mesh} can only be used to generate four and ten-\/node tets (i.\+e. tets with tri-\/linear and tri-\/quadratic shape functions). It should be easy to generalise the \char`\"{}scaffold-\/mesh\char`\"{}-\/based mesh generation procedure to higher-\/order elements but this has not been done yet. Any volunteers?\hypertarget{index_ex}{}\subsection{Exercises}\label{index_ex}

\begin{DoxyEnumerate}
\item Download and install \href{http://wias-berlin.de/software/tetgen//}{\tt {\ttfamily Tetgen}, }, and create your own meshes.
\item Experiment with the options that allow the specification of maximum element volumes etc.
\end{DoxyEnumerate}



 

\hypertarget{index_sources}{}\section{Source files for this tutorial}\label{index_sources}

\begin{DoxyItemize}
\item The source files for this tutorial are located in the directory\+:~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/meshing/mesh_from_tetgen/}{\tt demo\+\_\+drivers/meshing/mesh\+\_\+from\+\_\+tetgen/ } \end{center} ~\newline

\item The driver code is\+: ~\newline
~\newline
\begin{center} \href{../../../../demo_drivers/meshing/mesh_from_tetgen/mesh_from_tetgen_poisson.cc}{\tt demo\+\_\+drivers/meshing/mesh\+\_\+from\+\_\+tetgen/mesh\+\_\+from\+\_\+tetgen\+\_\+poisson.\+cc } \end{center} 
\end{DoxyItemize}



 

 \hypertarget{index_pdf}{}\section{P\+D\+F file}\label{index_pdf}
A \href{../latex/refman.pdf}{\tt pdf version} of this document is available. \end{document}
